<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive PDF Piping Takeoff Tool</title>
    <link rel="stylesheet" href="styles.css">
    <!-- PDF.js Library from Mozilla CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <!-- jsPDF and html2canvas for A3 Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <header>
        <h1>Interactive PDF Piping Takeoff Tool</h1>
        <div class="project-controls">
            <button id="import-project-btn">Import Project (.json)</button>
            <input type="file" id="import-project-input" accept=".json" style="display: none;">
            <button id="export-project-btn">Export Project (.json)</button>
            <button id="export-a3-pdf-btn">Export to A3 PDF</button>
        </div>
    </header>

    <main id="app-container">
        <!-- Left Panel: Controls and Register -->
        <div id="controls-panel">
            <div class="control-section">
                <h2>1. File & Scale</h2>
                <input type="file" id="pdf-upload" accept="application/pdf">
                <p id="pdf-name">No PDF loaded.</p>
                <div id="scale-section">
                    <button id="calibrate-btn">Set Scale</button>
                    <span id="scale-display">Scale not set.</span>
                </div>
                <p class="instructions">
                    <b>Instructions:</b><br>
                    - Left-Click & Drag to draw/measure.<br>
                    - Right-Click & Drag to pan the view.
                </p>
            </div>

            <div class="control-section">
                <h2>2. Pipe Definitions</h2>
                <button id="setup-pipes-btn">Manage Pipe Types</button>
            </div>

            <div class="control-section">
                <h2>3. Piping Register (Bill of Materials)</h2>
                <div id="table-wrapper">
                    <table id="piping-register">
                        <thead>
                            <tr>
                                <th>Color</th>
                                <th>Piping Type</th>
                                <th>Length X (m)</th>
                                <th>Length Y (m)</th>
                                <th>Length Z (m)</th>
                                <th>Total Length (m)</th>
                                <th>Volume (L)</th>
                                <th>Price ($)</th>
                                <th><button id="add-row-btn">+</button></th>
                            </tr>
                        </thead>
                        <tbody id="register-body">
                            <!-- Rows will be added dynamically by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Draggable Resizer -->
        <div id="resizer"></div>

        <!-- Right Panel: PDF Viewer -->
        <div id="viewer-container">
            <div id="pdf-viewer">
                <!-- Canvases for rendering PDF and drawings -->
                <canvas id="pdf-canvas"></canvas>
                <canvas id="drawing-canvas"></canvas>
            </div>
            <div id="viewer-controls">
                <button id="zoom-in-btn">+</button>
                <button id="zoom-out-btn">-</button>
            </div>
        </div>
    </main>

    <!-- Modal for Piping Information Database -->
    <div id="pipe-db-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Piping Information Database</h2>
            <div id="pipe-db-list"></div>
            <div id="add-pipe-form">
                <h3>Add New Pipe Type</h3>
                <input type="text" id="pipe-name-input" placeholder="e.g., DN100 Copper">
                <input type="number" id="pipe-diameter-input" placeholder="Internal Diameter (mm)">
                <input type="number" id="pipe-price-input" placeholder="Price per Meter ($)">
                <button id="add-pipe-type-btn">Add Pipe</button>
            </div>
        </div>
    </div>

    <!-- Main Application Script -->
    <script src="script.js"></script>
</body>
</html>
